# Phase 8: Job System (ì‘ì—… ì‹œìŠ¤í…œ)

## ğŸ“š ê°œìš”

Job Systemì€ **ë©€í‹°ì½”ì–´ CPUë¥¼ ìµœëŒ€í•œ í™œìš©**í•˜ê¸° ìœ„í•œ ë³‘ë ¬ ì²˜ë¦¬ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.
ê²Œì„ ì—”ì§„, ë Œë”ëŸ¬, ì‹œë®¬ë ˆì´ì…˜ ë“± ê³ ì„±ëŠ¥ ì‹œìŠ¤í…œì—ì„œ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ë²ˆ í•™ìŠµì—ì„œëŠ” ì§€ê¸ˆê¹Œì§€ ë°°ìš´ **Lock-Free ìë£Œêµ¬ì¡°ë“¤ì„ ì‹¤ì „ì— í†µí•©**í•©ë‹ˆë‹¤!

---

## ğŸ® ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€

### ê²Œì„ ì—”ì§„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Naughty Dog (The Last of Us, Uncharted)                   â”‚
â”‚                                                             â”‚
â”‚  â€¢ Fiber ê¸°ë°˜ Job System                                    â”‚
â”‚  â€¢ í”„ë ˆì„ë‹¹ ìˆ˜ì²œ ê°œì˜ ë§ˆì´í¬ë¡œ Job ì‹¤í–‰                      â”‚
â”‚  â€¢ ì˜ì¡´ì„± ê·¸ë˜í”„ë¡œ ìë™ ìŠ¤ì¼€ì¤„ë§                             â”‚
â”‚                                                             â”‚
â”‚  Unreal Engine 5                                            â”‚
â”‚  â€¢ TaskGraph ì‹œìŠ¤í…œ                                         â”‚
â”‚  â€¢ Nanite (ì§€ì˜¤ë©”íŠ¸ë¦¬), Lumen (ì¡°ëª…) ë³‘ë ¬ ì²˜ë¦¬              â”‚
â”‚                                                             â”‚
â”‚  Unity DOTS                                                 â”‚
â”‚  â€¢ Burst Compiler + Job System                              â”‚
â”‚  â€¢ Entity Component System ë³‘ë ¬ ì²˜ë¦¬                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë²„ / ë„¤íŠ¸ì›Œí¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê³ ì„±ëŠ¥ HTTP ì„œë²„                                           â”‚
â”‚                                                             â”‚
â”‚  â€¢ ìš”ì²­ë§ˆë‹¤ Job ìƒì„±                                         â”‚
â”‚  â€¢ I/O ì™„ë£Œ ì‹œ ì½œë°± Job ìŠ¤ì¼€ì¤„ë§                            â”‚
â”‚  â€¢ ìˆ˜ì²œ RPS ì²˜ë¦¬                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ í•µì‹¬ ì•„í‚¤í…ì²˜

### ê¸°ë³¸ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Job System                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Job Queue                         â”‚   â”‚
â”‚  â”‚    [Job1] â†’ [Job2] â†’ [Job3] â†’ [Job4] â†’ ...          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚           â”‚           â”‚           â”‚             â”‚
â”‚           â–¼           â–¼           â–¼           â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Worker  â”‚  â”‚ Worker  â”‚  â”‚ Worker  â”‚  â”‚ Worker  â”‚        â”‚
â”‚  â”‚ Thread 0â”‚  â”‚ Thread 1â”‚  â”‚ Thread 2â”‚  â”‚ Thread 3â”‚        â”‚
â”‚  â”‚  (CPU 0)â”‚  â”‚  (CPU 1)â”‚  â”‚  (CPU 2)â”‚  â”‚  (CPU 3)â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Job ì˜ì¡´ì„± (Dependency)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê²Œì„ í”„ë ˆì„ ì²˜ë¦¬ ì˜ˆì‹œ                                       â”‚
â”‚                                                             â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚           â”‚  Input     â”‚  â—„â”€â”€ ë¨¼ì € ì‹¤í–‰                     â”‚
â”‚           â”‚  ì²˜ë¦¬      â”‚                                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                 â”‚                                           â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚      â–¼          â–¼          â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚Physics â”‚ â”‚   AI   â”‚ â”‚Animationâ”‚  â—„â”€â”€ ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥      â”‚
â”‚  â”‚ Update â”‚ â”‚ Update â”‚ â”‚ Update â”‚                          â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                          â”‚
â”‚      â”‚          â”‚          â”‚                                â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                 â–¼                                           â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚           â”‚  Render    â”‚  â—„â”€â”€ ëª¨ë“  ì—…ë°ì´íŠ¸ ì™„ë£Œ í›„         â”‚
â”‚           â”‚  Submit    â”‚                                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ ì„¤ê³„ ì›ì¹™

### 1. Job êµ¬ì¡°

```cpp
/**
 * Job ê¸°ë³¸ êµ¬ì¡°
 * 
 * ìµœì†Œí•œì˜ ì˜¤ë²„í—¤ë“œë¡œ ì‘ì—… ì •ì˜
 */
struct Job {
    // ì‹¤í–‰í•  í•¨ìˆ˜ (í•¨ìˆ˜ í¬ì¸í„° ë˜ëŠ” std::function)
    void (*function)(void* data);
    
    // í•¨ìˆ˜ì— ì „ë‹¬í•  ë°ì´í„°
    void* data;
    
    // ì˜ì¡´ì„± ì¹´ìš´í„° (0ì´ ë˜ë©´ ì‹¤í–‰ ê°€ëŠ¥)
    std::atomic<int> unfinished_jobs;
    
    // ë¶€ëª¨ Job (ì™„ë£Œ ì‹œ ë¶€ëª¨ì˜ ì¹´ìš´í„° ê°ì†Œ)
    Job* parent;
};
```

### 2. Worker Thread

```cpp
/**
 * Worker Thread ê¸°ë³¸ ë£¨í”„
 * 
 * í•µì‹¬: ë°”ì˜ê²Œ ì¼í•˜ê±°ë‚˜, ì¡°ìš©íˆ ëŒ€ê¸°
 */
void worker_thread_main() {
    while (!should_stop) {
        Job* job = try_get_job();  // Lock-Freeë¡œ Job ê°€ì ¸ì˜¤ê¸°
        
        if (job) {
            execute(job);
            finish(job);
        } else {
            // ì˜µì…˜ 1: ìŠ¤í•€ ëŒ€ê¸° (ë‚®ì€ ë ˆì´í„´ì‹œ)
            // ì˜µì…˜ 2: ì¡°ê±´ ë³€ìˆ˜ ëŒ€ê¸° (CPU ì ˆì•½)
            wait_for_job();
        }
    }
}
```

### 3. Job ìŠ¤ì¼€ì¤„ë§ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì „ëµ 1: ë‹¨ì¼ ê¸€ë¡œë²Œ í                                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚      Global Job Queue (MPMC)            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚           â”‚           â”‚                         â”‚
â”‚           â–¼           â–¼           â–¼                         â”‚
â”‚       Worker 0    Worker 1    Worker 2                      â”‚
â”‚                                                             â”‚
â”‚  ì¥ì : êµ¬í˜„ ë‹¨ìˆœ                                             â”‚
â”‚  ë‹¨ì : ê²½í•©(Contention) ë†’ìŒ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì „ëµ 2: Workerë³„ ë¡œì»¬ í + Work Stealing                   â”‚
â”‚                                                             â”‚
â”‚  Worker 0         Worker 1         Worker 2                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Local  â”‚      â”‚ Local  â”‚      â”‚ Local  â”‚               â”‚
â”‚  â”‚ Queue  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Queue  â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Queue  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚      â”‚               â”‚               â”‚                      â”‚
â”‚   ìê¸° í         íê°€ ë¹„ë©´        ë‹¤ë¥¸ ì›Œì»¤               â”‚
â”‚   ì—ì„œ pop      ë‹¤ë¥¸ íì—ì„œ steal    ì—ì„œ steal             â”‚
â”‚                                                             â”‚
â”‚  ì¥ì : ë‚®ì€ ê²½í•©, ë¶€í•˜ ë¶„ì‚°                                  â”‚
â”‚  ë‹¨ì : êµ¬í˜„ ë³µì¡                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ êµ¬í˜„ ë‹¨ê³„ (í•™ìŠµ ìˆœì„œ)

### Step 1: Simple Job System (ê¸€ë¡œë²Œ í)

**ëª©í‘œ**: ê°€ì¥ ë‹¨ìˆœí•œ í˜•íƒœë¡œ ì‹œì‘

```cpp
/**
 * Step 1ì—ì„œ êµ¬í˜„í•  ê²ƒ:
 * 
 * 1. Job êµ¬ì¡°ì²´ (í•¨ìˆ˜ í¬ì¸í„° + ë°ì´í„°)
 * 2. ê¸€ë¡œë²Œ MPMC Queue (ì´ë¯¸ êµ¬í˜„í•¨!)
 * 3. Worker Thread Pool
 * 4. schedule(job) / wait() API
 */

class SimpleJobSystem {
public:
    // Job ìŠ¤ì¼€ì¤„ë§
    void schedule(Job* job);
    
    // ëª¨ë“  Job ì™„ë£Œ ëŒ€ê¸°
    void wait_all();
    
private:
    MPMCQueue<Job*> job_queue_;
    std::vector<std::thread> workers_;
    std::atomic<bool> running_{true};
};
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
- [ ] ë‹¨ì¼ Job ì‹¤í–‰
- [ ] 100ê°œ Job ë³‘ë ¬ ì‹¤í–‰
- [ ] ê²°ê³¼ í•©ì‚° ì •í™•ì„± ê²€ì¦

---

### Step 2: Job Counter (ì˜ì¡´ì„± ê¸°ì´ˆ)

**ëª©í‘œ**: Job ì™„ë£Œ ì¶”ì 

```cpp
/**
 * Job Counter: ì—¬ëŸ¬ Jobì˜ ì™„ë£Œë¥¼ ì¶”ì 
 * 
 * ì‚¬ìš© ì˜ˆ:
 *   Counter counter(10);  // 10ê°œ Job ì¶”ì 
 *   for (int i = 0; i < 10; i++) {
 *       schedule(job, &counter);
 *   }
 *   wait_for_counter(&counter);  // 10ê°œ ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
 */
struct Counter {
    std::atomic<int> value;
    
    Counter(int initial) : value(initial) {}
    
    void decrement() {
        value.fetch_sub(1, std::memory_order_acq_rel);
    }
    
    bool is_zero() const {
        return value.load(std::memory_order_acquire) == 0;
    }
};
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
- [ ] Counter ê°ì†Œ ì •í™•ì„±
- [ ] wait_for_counter() ë™ì‘
- [ ] ë©€í‹°ìŠ¤ë ˆë“œ Counter ì•ˆì „ì„±

---

### Step 3: Parent-Child Job (ì˜ì¡´ì„± ê·¸ë˜í”„)

**ëª©í‘œ**: Job ê°„ ì˜ì¡´ì„± í‘œí˜„

```cpp
/**
 * Parent-Child ê´€ê³„
 * 
 * Parent Jobì€ ëª¨ë“  Childê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì™„ë£Œë˜ì§€ ì•ŠìŒ
 * 
 *      [Parent Job]
 *       unfinished = 3
 *           â”‚
 *    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”
 *    â–¼      â–¼      â–¼
 * [Child1][Child2][Child3]
 * 
 * Child ì™„ë£Œ ì‹œ â†’ Parentì˜ unfinished ê°ì†Œ
 * unfinished == 0 â†’ Parent ì™„ë£Œ!
 */
struct Job {
    std::atomic<int> unfinished_jobs{1};  // ìê¸° ìì‹  í¬í•¨
    Job* parent{nullptr};
};

void finish_job(Job* job) {
    int unfinished = job->unfinished_jobs.fetch_sub(1, std::memory_order_acq_rel);
    if (unfinished == 1) {  // ë§ˆì§€ë§‰ì´ì—ˆìŒ
        if (job->parent) {
            finish_job(job->parent);  // ë¶€ëª¨ ì¹´ìš´í„°ë„ ê°ì†Œ
        }
    }
}
```

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**:
- [ ] Parent-Child ê´€ê³„ ì„¤ì •
- [ ] Child ì™„ë£Œ ì‹œ Parent ì•Œë¦¼
- [ ] ê¹Šì€ ê³„ì¸µ êµ¬ì¡° (3-4ë‹¨ê³„)

---

### Step 4: Work Stealing (ê³ ê¸‰)

**ëª©í‘œ**: ë¶€í•˜ ë¶„ì‚° ìµœì í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Work Stealing Deque (Double-Ended Queue)                  â”‚
â”‚                                                             â”‚
â”‚  Owner:                              Thief:                 â”‚
â”‚  - push_bottom()                     - steal() from top    â”‚
â”‚  - pop_bottom()                                             â”‚
â”‚                                                             â”‚
â”‚       Top (steal here)                                      â”‚
â”‚        â”‚                                                    â”‚
â”‚        â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚  â”‚  [Job5] â† oldest       â”‚                                â”‚
â”‚  â”‚  [Job4]                â”‚                                â”‚
â”‚  â”‚  [Job3]                â”‚                                â”‚
â”‚  â”‚  [Job2]                â”‚                                â”‚
â”‚  â”‚  [Job1] â† newest       â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚        â–²                                                    â”‚
â”‚        â”‚                                                    â”‚
â”‚      Bottom (push/pop here)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„ íŒíŠ¸**:
- OwnerëŠ” Bottomì—ì„œ push/pop (LIFO - ìºì‹œ ì¹œí™”ì )
- ThiefëŠ” Topì—ì„œ steal (FIFO - ì˜¤ë˜ëœ ê²ƒë¶€í„°)
- Lock-Free CAS ê¸°ë°˜

---

### Step 5: Fiber/Coroutine ê¸°ë°˜ (ë§¤ìš° ê³ ê¸‰, ì„ íƒ)

**ëª©í‘œ**: Job ì¼ì‹œì •ì§€/ì¬ê°œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¬¸ì œ ìƒí™©: Jobì´ ë‹¤ë¥¸ Jobì„ ê¸°ë‹¤ë ¤ì•¼ í•  ë•Œ                  â”‚
â”‚                                                             â”‚
â”‚  void expensive_job() {                                     â”‚
â”‚      auto result = spawn_child_job();                       â”‚
â”‚      wait_for(result);  // â† ì—¬ê¸°ì„œ ìŠ¤ë ˆë“œê°€ ë¸”ë¡ë¨!        â”‚
â”‚      use(result);                                           â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  ìŠ¤ë ˆë“œ ë¸”ë¡ = ìì› ë‚­ë¹„!                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í•´ê²°: Fiber (ê²½ëŸ‰ ì½”ë£¨í‹´)                                  â”‚
â”‚                                                             â”‚
â”‚  void expensive_job() {                                     â”‚
â”‚      auto result = spawn_child_job();                       â”‚
â”‚      yield_until(result);  // â† Fiber ì¼ì‹œì •ì§€, ìŠ¤ë ˆë“œ ë°˜í™˜ â”‚
â”‚      use(result);          // â† ë‚˜ì¤‘ì— ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì¬ê°œ â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  - FiberëŠ” ìì²´ ìŠ¤íƒì„ ê°€ì§                                 â”‚
â”‚  - ì¼ì‹œì •ì§€/ì¬ê°œ ì‹œ ìŠ¤íƒ ì „í™˜ (ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­)             â”‚
â”‚  - OS ìŠ¤ë ˆë“œë³´ë‹¤ í›¨ì”¬ ê²½ëŸ‰ (ìˆ˜ì²œ ê°œ ìƒì„± ê°€ëŠ¥)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì°¸ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- Windows: `ConvertThreadToFiber()`, `CreateFiber()`
- POSIX: `makecontext()`, `swapcontext()`
- í¬ë¡œìŠ¤í”Œë«í¼: Boost.Context, libco

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. False Sharing in Job Arrays

```cpp
// ë‚˜ìœ ì˜ˆ: ì—°ì†ëœ Jobë“¤ì´ ê°™ì€ ìºì‹œ ë¼ì¸ ê³µìœ 
Job jobs[1000];  // ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ìˆ˜ì •

// ì¢‹ì€ ì˜ˆ: íŒ¨ë”©ìœ¼ë¡œ ìºì‹œ ë¼ì¸ ë¶„ë¦¬
struct alignas(64) PaddedJob {
    Job job;
};
PaddedJob jobs[1000];
```

### 2. ìŠ¤í•€ vs ëŒ€ê¸°

```cpp
// ìŠ¤í•€ ëŒ€ê¸°: ë‚®ì€ ë ˆì´í„´ì‹œ, ë†’ì€ CPU ì‚¬ìš©
while (!job_available()) {
    std::this_thread::yield();  // ë˜ëŠ” _mm_pause()
}

// ì¡°ê±´ ë³€ìˆ˜ ëŒ€ê¸°: ë†’ì€ ë ˆì´í„´ì‹œ, ë‚®ì€ CPU ì‚¬ìš©
std::unique_lock lock(mutex);
cv.wait(lock, [] { return job_available(); });

// í•˜ì´ë¸Œë¦¬ë“œ: ì ê¹ ìŠ¤í•€ í›„ ëŒ€ê¸°
for (int i = 0; i < 1000; i++) {
    if (job_available()) return;
    _mm_pause();
}
cv.wait(...);
```

### 3. ë°ë“œë½ ë°©ì§€

```cpp
// ìœ„í—˜: Jobì´ ë‹¤ë¥¸ Jobì„ ë™ê¸°ì ìœ¼ë¡œ ëŒ€ê¸°
void job_a() {
    schedule(job_b);
    wait_for(job_b);  // job_bê°€ job_aë¥¼ ëŒ€ê¸°í•˜ë©´ ë°ë“œë½!
}

// í•´ê²°: ì˜ì¡´ì„± ê·¸ë˜í”„ë¡œ ëª…ì‹œì  í‘œí˜„
schedule(job_b, /*dependency=*/job_a);  // job_a ì™„ë£Œ í›„ job_b ì‹¤í–‰
```

---

## ğŸ› ï¸ ìš°ë¦¬ì˜ Lock-Free ë„êµ¬ í™œìš©

| ì»´í¬ë„ŒíŠ¸ | ì‚¬ìš©í•  ê¸°ì¡´ êµ¬í˜„ |
|---------|-----------------|
| ê¸€ë¡œë²Œ Job í | `MPMCQueue<Job*>` |
| ë¡œì»¬ Job í | `SPSCQueue<Job*>` (SPSC) ë˜ëŠ” ìƒˆë¡œ êµ¬í˜„ |
| Job í• ë‹¹ | `MemoryPool<Job>` |
| ë™ê¸°í™” (í•„ìš”ì‹œ) | `SpinLock` |

---

## âœ… TDD í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### Step 1: Simple Job System
- [ ] Worker Thread ìƒì„±/ì¢…ë£Œ
- [ ] ë‹¨ì¼ Job ì‹¤í–‰
- [ ] Nê°œ Job ë³‘ë ¬ ì‹¤í–‰
- [ ] ê²°ê³¼ í•©ì‚° ì •í™•ì„±

### Step 2: Job Counter
- [ ] Counter ì´ˆê¸°í™”/ê°ì†Œ
- [ ] wait_for_counter() ë¸”ë¡/í•´ì œ
- [ ] ë©€í‹°ìŠ¤ë ˆë“œ ì•ˆì „ì„±

### Step 3: Parent-Child
- [ ] Parent-Child ê´€ê³„ ì„¤ì •
- [ ] Child ì™„ë£Œ â†’ Parent ì•Œë¦¼
- [ ] ê¹Šì€ ê³„ì¸µ êµ¬ì¡°

### Step 4: Work Stealing
- [ ] Deque ê¸°ë³¸ ë™ì‘
- [ ] Owner push/pop
- [ ] Thief steal
- [ ] ë¶€í•˜ ë¶„ì‚° í™•ì¸

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ìˆ˜ì²œ ê°œ Job ì²˜ë¦¬
- [ ] new/delete vs MemoryPool ë¹„êµ
- [ ] ê¸€ë¡œë²Œ í vs Work Stealing ë¹„êµ

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Step 1: Simple Job System êµ¬í˜„
- [ ] Step 2: Job Counter êµ¬í˜„
- [ ] Step 3: Parent-Child ì˜ì¡´ì„± êµ¬í˜„
- [ ] Step 4: Work Stealing êµ¬í˜„ (ì„ íƒ)
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- [ ] (ì„ íƒ) Fiber ê¸°ë°˜ Job System

---

## ğŸ¯ í•™ìŠµ ëª©í‘œ

1. **ë©€í‹°ìŠ¤ë ˆë“œ ì•„í‚¤í…ì²˜**: Thread Pool, Worker, Scheduler
2. **ì‹¤ì „ Lock-Free í™œìš©**: MPMC Queue, Memory Pool í†µí•©
3. **ì˜ì¡´ì„± ê´€ë¦¬**: DAG ê¸°ë°˜ íƒœìŠ¤í¬ ìŠ¤ì¼€ì¤„ë§
4. **ë¶€í•˜ ë¶„ì‚°**: Work Stealing íŒ¨í„´
5. **ê²Œì„ ì—”ì§„ íŒ¨í„´**: ì‹¤ì œ ê²Œì„ì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€

---

## ğŸ“š ì°¸ê³  ìë£Œ

### GDC ë°œí‘œ (í•„ìˆ˜ ì‹œì²­)
1. **"Parallelizing the Naughty Dog Engine Using Fibers" (2015)**
   - Christian Gyrling
   - Fiber ê¸°ë°˜ Job Systemì˜ ë°”ì´ë¸”
   - https://www.gdcvault.com/play/1022186/

2. **"Destiny's Multithreaded Rendering Architecture" (2015)**
   - Natalya Tatarchuk, Bungie
   - ëŒ€ê·œëª¨ ë Œë”ëŸ¬ì˜ ë³‘ë ¬í™”

### ì˜¤í”ˆì†ŒìŠ¤ êµ¬í˜„ (ì°¸ê³ ìš©)
1. **enkiTS** - https://github.com/dougbinks/enkiTS
   - ì‹¬í”Œí•˜ê³  ë°°ìš°ê¸° ì¢‹ìŒ
   - C++ í—¤ë” ì˜¨ë¦¬

2. **marl** - https://github.com/google/marl
   - Googleì˜ Fiber ê¸°ë°˜ ìŠ¤ì¼€ì¤„ëŸ¬
   - C++11, í¬ë¡œìŠ¤í”Œë«í¼

3. **FiberTaskingLib** - https://github.com/RichieSams/FiberTaskingLib
   - Naughty Dog ìŠ¤íƒ€ì¼ êµ¬í˜„

### ë¸”ë¡œê·¸
1. **Molecular Musings Job System** (ê°•ë ¥ ì¶”ì²œ!)
   - https://blog.molecular-matters.com/2015/08/24/job-system-2-0-lock-free-work-stealing-part-1-basics/
   - ìƒì„¸í•œ êµ¬í˜„ ì„¤ëª…

2. **Our Machinery**
   - Fiber ê¸°ë°˜ Job System ì„¤ëª…

---

## ë‹¤ìŒ ë‹¨ê³„

Job System ì™„ë£Œ í›„:
1. **ì‹¤ì „ í”„ë¡œì íŠ¸**: ê°„ë‹¨í•œ ë©€í‹°ìŠ¤ë ˆë“œ ê²Œì„/ì‹œë®¬ë ˆì´ì…˜
2. **Raytracer**: ë³‘ë ¬ ë ˆì´íŠ¸ë ˆì´ì‹± (ì™„ë²½í•œ ì—°ìŠµ!)
3. **ECS (Entity Component System)**: Job Systemê³¼ ì°°ë–¡ê¶í•©
